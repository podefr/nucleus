/**
 * Emily
 * Copyright(c) 2012-2013 Olivier Scherrer <pode.fr@gmail.com>
 * MIT Licensed
 */

/**
 * Olives http://flams.github.com/olives
 * The MIT License (MIT)
 * Copyright (c) 2012 Olivier Scherrer <pode.fr@gmail.com> - Olivier Wietrich <olivier.wietrich@gmail.com>
 */

define("Tools",[],function(){return{getGlobal:function(){var t=function(){return this};return t.call(null)},mixin:function(t,n,r){return this.loop(t,function(e,i){if(!n[i]||!r)n[i]=t[i]}),n},count:function(t){var n=0;return this.loop(t,function(){n++}),n},compareObjects:function(t,n){var r=function(e){return Object.getOwnPropertyNames(e).sort().join("")};return r(t)==r(n)},compareNumbers:function(t,n){return t>n?1:t<n?-1:0},toArray:function(t){return Array.prototype.slice.call(t)},loop:function(t,n,r){var i,s;if(t instanceof Object&&n instanceof Function){if(t instanceof Array)for(i=0;i<t.length;i++)n.call(r,t[i],i,t);else for(i in t)t.hasOwnProperty(i)&&n.call(r,t[i],i,t);return!0}return!1},objectsDiffs:function(t,n){if(t instanceof Object&&n instanceof Object){var r=[],i=[],s=[],o=[];return this.loop(n,function(e,n){typeof t[n]=="undefined"?o.push(n):e!==t[n]?i.push(n):e===t[n]&&r.push(n)}),this.loop(t,function(e,t){typeof n[t]=="undefined"&&s.push(t)}),{updated:i,unchanged:r,added:o,deleted:s}}return!1},jsonify:function(t){return t instanceof Object?JSON.parse(JSON.stringify(t)):!1},clone:function(t){return t instanceof Array?t.slice(0):typeof t!="object"||t===null||t instanceof RegExp?!1:this.mixin(t,{})},getNestedProperty:function(t,n){if(t&&t instanceof Object){if(typeof n=="string"&&n!=""){var r=n.split(".");return r.reduce(function(e,t){return e&&e[t]},t)}return typeof n=="number"?t[n]:t}return t},setNestedProperty:function(t,n,r){if(t&&t instanceof Object){if(typeof n=="string"&&n!=""){var i=n.split(".");return i.reduce(function(e,t,n){return e[t]=e[t]||{},i.length==n+1&&(e[t]=r),e[t]},t)}return typeof n=="number"?(t[n]=r,t[n]):t}return t}}}),define("DomUtils",["Tools"],function(e){return{getNodes:function(t,n){return this.isAcceptedType(t)?(t.parentNode||document.createDocumentFragment().appendChild(t),t.parentNode.querySelectorAll(n||"*")):!1},getDataset:function(t){var n=0,r,i={},s,o;if(this.isAcceptedType(t)){if(t.hasOwnProperty("dataset"))return t.dataset;for(r=t.attributes.length;n<r;n++)s=t.attributes[n].name.split("-"),s.shift()=="data"&&(i[o=s.join("-")]=t.getAttribute("data-"+o));return i}return!1},isAcceptedType:function(t){return t instanceof HTMLElement||t instanceof SVGElement?!0:!1},setAttribute:function(t,n,r){return t instanceof HTMLElement?(t[n]=r,!0):t instanceof SVGElement?(t.setAttribute(n,r),!0):!1},matches:function(n,r,i){return e.toArray(this.getNodes(i,r)).indexOf(n)>-1}}}),define("Plugins",["Tools","DomUtils"],function(t,n){return function(){var r={},i=function(t){return t.trim()},s=function(t,n,s){n.split(";").forEach(function(e){var n=e.split(":"),o=n[0].trim(),u=n[1]?n[1].split(",").map(i):[];u.unshift(t),r[s]&&r[s][o]&&r[s][o].apply(r[s],u)})};this.add=function(t,n){var i=this,s="plugins";return typeof t=="string"&&typeof n=="object"&&n?(r[t]=n,n[s]={name:t,apply:function(){return i.apply.apply(i,arguments)}},!0):!1},this.addAll=function(n){return t.loop(n,function(e,t){this.add(t,e)},this)},this.get=function(t){return r[t]},this.del=function(t){return delete r[t]},this.apply=function(r){var i;return n.isAcceptedType(r)?(i=n.getNodes(r),t.loop(t.toArray(i),function(e){t.loop(n.getDataset(e),function(t,n){s(e,t,n)})}),r):!1}}});